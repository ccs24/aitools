define("aitoolsub_valuemapdoc/valuemaps_manager",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){var table=null,config=window.valuemapsConfig||{},allData=[];M.cfg.fullname||M.cfg.username;return{init:function(){console.log("[valuemaps_manager] Module loaded");var columnsElement=document.querySelector("#valuemap-columns");if(columnsElement&&columnsElement.textContent){var columns;try{columns=JSON.parse(columnsElement.textContent),console.log("[valuemaps_manager] Parsed columns:",columns)}catch(e){return void console.error("[valuemaps_manager] Error parsing columns:",e)}Array.isArray(columns)?this.waitForTabulator(columns):console.error("[valuemaps_manager] Columns is not an array")}else console.warn("[valuemaps_manager] Columns not found")},waitForTabulator:function(columns){var self=this;void 0!==window.Tabulator?(console.log("[valuemaps_manager] Tabulator available, initializing..."),this.bindEvents(),this.loadData(columns)):(console.log("[valuemaps_manager] Waiting for Tabulator..."),setTimeout((function(){self.waitForTabulator(columns)}),100))},bindEvents:function(){var self=this;$("#refresh-data").on("click",(function(){self.init()})),$("#export-data").on("click",(function(){self.showExportOptions()})),$("#clear-filters").on("click",(function(){self.clearFilters()})),$("#filter-course, #filter-activity, #filter-type").on("change",(function(){self.applyFilters()})),$("#search-entries").on("input",(function(){self.applyFilters()})),$("#retry-loading").on("click",(function(){self.init()})),$("#toggle-fullscreen").on("click",(function(){self.toggleFullscreen()}))},loadData:function(columns){var self=this;this.showLoadingState(),Ajax.call([{methodname:"aitoolsub_valuemapdoc_get_all_entries_global",args:{userid:config.userid||0}}])[0].done((function(data){allData=data.entries||[],console.log("[valuemaps_manager] Entries loaded:",allData,"records"),self.updateStatistics(data.statistics),self.populateFilterOptions(data);var processedData=self.processDataWithSeparators(allData);processedData.length>0?(self.initializeTable(columns,processedData),self.showTableState()):self.showEmptyState()})).fail((function(error){console.error("[valuemaps_manager] Failed to load entries:",error),self.showErrorState(error.message||"Unknown error occurred"),Notification.exception(error)}))},processDataWithSeparators:function(entries){if(0===entries.length)return[];var processedData=[],currentGroup=null;return entries.forEach((function(entry){var groupKey=entry.course_name+" â†’ "+entry.activity_name;currentGroup!==groupKey&&(processedData.push({id:"separator_"+processedData.length,isSeparator:!0,groupTitle:groupKey,course_name:entry.course_name,activity_name:entry.activity_name}),currentGroup=groupKey),processedData.push(entry)})),processedData},updateStatistics:function(stats){$("#stat-total-entries").text(stats.total_entries||0),$("#stat-unique-courses").text(stats.unique_courses||0),$("#stat-unique-activities").text(stats.unique_activities||0)},populateFilterOptions:function(data){var stats=data.statistics||{},courseSelect=$("#filter-course");courseSelect.find("option:not(:first)").remove(),stats.courses_list&&stats.courses_list.forEach((function(course){courseSelect.append('<option value="'+course+'">'+course+"</option>")}));var activitySelect=$("#filter-activity");activitySelect.find("option:not(:first)").remove(),stats.activities_list&&stats.activities_list.forEach((function(activity){activitySelect.append('<option value="'+activity+'">'+activity+"</option>")}))},getUsernameFromResponse:function(response){var currentUserId=M.cfg.userid,userEntry=response.find((function(entry){return entry.userid==currentUserId}));return userEntry&&userEntry.username?userEntry.username:M.cfg.fullname||M.cfg.username||"Ja"},prepareColumns:function(columns){var enhancedColumns=[];return columns.forEach((function(col){enhancedColumns.push({title:col.title,field:col.field,hozAlign:col.hozAlign||"left",headerSort:!1!==col.headerSort,width:col.width||150,headerFilter:"input",editable:!1,formatter:function(cell){if(cell.getRow().getData().isSeparator)return"";var value=cell.getValue();return value&&value.length>50?'<div class="text-truncate" style="max-width: '+(col.width-20)+'px;" title="'+value+'">'+value+"</div>":value||""}})})),enhancedColumns.push({title:"Author",field:"username",hozAlign:"left",headerSort:!0,width:120,headerFilter:"input",editable:!1,formatter:function(cell){var row=cell.getRow();if(row.getData().isSeparator)return"";var value=cell.getValue();return 1===row.getData().ismaster?'<i class="fa fa-star text-warning" title="Master entry"></i> '+value:value}}),enhancedColumns.push({title:"Actions",field:"actions",width:120,headerSort:!1,formatter:function(cell){var data=cell.getRow().getData();return data.isSeparator?"":'<div class="btn-group btn-group-sm" role="group"><a href="'+data.view_url+'" class="btn btn-outline-primary btn-sm" title="View Entry"><i class="fa fa-eye"></i></a><a href="'+data.edit_url+'" class="btn btn-outline-secondary btn-sm" title="Edit in Activity" target="_blank"><i class="fa fa-edit"></i></a></div>'}}),enhancedColumns},initializeTable:function(columns,processedData){var self=this,enhancedColumns=this.prepareColumns(columns),currentUsername=this.getUsernameFromResponse(allData);(table=new window.Tabulator("#valuemaps-table",{data:processedData,columns:enhancedColumns,layout:"fitDataTable",height:"600px",pagination:"local",paginationSize:20,paginationSizeSelector:[10,20,50,100],movableColumns:!0,resizableRows:!1,selectable:!1,tooltips:!0,placeholder:"No entries to display",persistence:{sort:!0,filter:!0,columns:!0,page:!0},persistenceID:"ai-tools-valuemaps-table",locale:!0,langs:{default:{pagination:{page_size:"Page Size",first:"First",prev:"Prev",next:"Next",last:"Last"},headerFilters:{default:"Filter column..."}}},rowFormatter:function(row){var data=row.getData();if(data.isSeparator){row.getElement().style.backgroundColor="#f8f9fa",row.getElement().style.fontWeight="bold",row.getElement().style.borderTop="2px solid #dee2e6";var cells=row.getCells();if(cells.length>0){var firstCell=cells[0];firstCell.getElement().colSpan=cells.length,firstCell.getElement().innerHTML='<i class="fa fa-folder-open me-2"></i>'+data.groupTitle;for(var i=1;i<cells.length;i++)cells[i].getElement().style.display="none"}}else 1===data.ismaster&&(row.getElement().style.backgroundColor="#eaffea",row.getElement().classList.add("ismaster"))}})).on("tableBuilt",(function(){console.log("[valuemaps_manager] Table built successfully"),table.setHeaderFilterValue("username",currentUsername),self.addUserFilterToggle(table,currentUsername)})),table.on("rowDblClick",(function(e,row){var data=row.getData();data.isSeparator||window.open(data.edit_url,"_blank")})),window.valuemapsManager=this},addUserFilterToggle:function(table,currentUsername){var toolbar=$(".card-header .table-controls");if(0!==toolbar.length){toolbar.prepend('<button type="button" class="btn btn-sm btn-outline-info ms-2" id="user-filter-toggle"><i class="fa fa-user"></i> My Entries</button>');var showingOnlyMine=!0;$("#user-filter-toggle").on("click",(function(){var $btn=$(this);showingOnlyMine?(table.clearHeaderFilter("username"),$btn.html('<i class="fa fa-users"></i> All Entries'),$btn.removeClass("btn-outline-info").addClass("btn-outline-secondary"),showingOnlyMine=!1):(table.setHeaderFilterValue("username",currentUsername),$btn.html('<i class="fa fa-user"></i> My Entries'),$btn.removeClass("btn-outline-secondary").addClass("btn-outline-info"),showingOnlyMine=!0)}))}},applyFilters:function(){if(table){var courseFilter=$("#filter-course").val(),activityFilter=$("#filter-activity").val(),searchFilter=($("#filter-type").val(),$("#search-entries").val());table.clearFilter();var filters=[];courseFilter&&filters.push({field:"course_name",type:"=",value:courseFilter}),activityFilter&&filters.push({field:"activity_name",type:"=",value:activityFilter}),searchFilter&&filters.push([{field:"course_name",type:"like",value:searchFilter},{field:"activity_name",type:"like",value:searchFilter}]),filters.push((function(data){return!data.isSeparator})),filters.length>0&&table.setFilter(filters)}},clearFilters:function(){$("#filter-course, #filter-activity, #filter-type").val(""),$("#search-entries").val(""),table&&(table.clearFilter(),table.clearHeaderFilter())},showExportOptions:function(){var self=this,exportMenu=$('<div class="dropdown-menu dropdown-menu-end show"><h6 class="dropdown-header">Export Options</h6><button class="dropdown-item" data-format="csv"><i class="fa fa-file-csv me-2"></i>Export as CSV</button><button class="dropdown-item" data-format="json"><i class="fa fa-file-code me-2"></i>Export as JSON</button><button class="dropdown-item" data-format="xlsx"><i class="fa fa-file-excel me-2"></i>Export as Excel</button></div>'),exportBtn=$("#export-data"),offset=exportBtn.offset();exportMenu.css({position:"absolute",top:offset.top+exportBtn.outerHeight(),left:offset.left-150,"z-index":1050}),exportMenu.find("[data-format]").on("click",(function(){var format=$(this).data("format");self.exportData(format),exportMenu.remove()})),$(document).one("click",(function(){exportMenu.remove()})),$("body").append(exportMenu)},exportData:function(format){if(table){var filename="valuemap_entries_"+(new Date).toISOString().slice(0,10),exportData=table.getData().filter((function(row){return!row.isSeparator}));if("csv"===format)table.download("csv",filename+".csv",{},"active");else if("json"===format){var dataStr=JSON.stringify(exportData,null,2),dataBlob=new Blob([dataStr],{type:"application/json"}),url=URL.createObjectURL(dataBlob),link=document.createElement("a");link.href=url,link.download=filename+".json",link.click(),URL.revokeObjectURL(url)}else"xlsx"===format&&table.download("xlsx",filename+".xlsx",{sheetName:"Value Map Entries"},"active")}},toggleFullscreen:function(){$("body").toggleClass("valuemapdoc-fullscreen");var $btn=$("#toggle-fullscreen");$("body").hasClass("valuemapdoc-fullscreen")?($btn.html('<i class="fa fa-compress"></i> Exit Fullscreen'),table&&table.redraw(!0)):($btn.html('<i class="fa fa-expand"></i> Fullscreen'),table&&table.redraw(!0))},showEntryDetails:function(entryId){var entryData=allData.find((function(entry){return entry.id===entryId&&!entry.isSeparator}));if(entryData){var modalHtml='<div class="modal fade" id="entryDetailsModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Entry Details</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="row mb-3"><div class="col-md-6"><strong>Course:</strong><br>'+entryData.course_name+'</div><div class="col-md-6"><strong>Activity:</strong><br>'+entryData.activity_name+'</div></div><div class="row mb-3"><div class="col-md-6"><strong>Author:</strong><br>'+entryData.user_fullname+'</div></div><div class="row mb-3"><div class="col-md-6"><strong>Created:</strong><br>'+entryData.timecreated_formatted+'</div><div class="col-md-6"><strong>Modified:</strong><br>'+entryData.timemodified_formatted+'</div></div></div><div class="modal-footer"><a href="'+entryData.edit_url+'" class="btn btn-primary" target="_blank"><i class="fa fa-edit"></i> Edit in Activity</a><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div></div></div></div>';$("#entryDetailsModal").remove(),$("body").append(modalHtml),new bootstrap.Modal(document.getElementById("entryDetailsModal")).show()}},formatTypeName:function(type){return{customer_profile:"Customer Profile",value_proposition:"Value Proposition",pain_analysis:"Pain Analysis",value_map:"Value Map",general:"General",unknown:"Unknown"}[type]||type},showLoadingState:function(){$("#loading-overlay").show(),$("#valuemaps-table").hide(),$("#empty-state").hide(),$("#error-state").hide()},showTableState:function(){$("#loading-overlay").hide(),$("#valuemaps-table").show(),$("#empty-state").hide(),$("#error-state").hide()},showEmptyState:function(){$("#loading-overlay").hide(),$("#valuemaps-table").hide(),$("#empty-state").show(),$("#error-state").hide()},showErrorState:function(message){$("#loading-overlay").hide(),$("#valuemaps-table").hide(),$("#empty-state").hide(),$("#error-state").show(),$("#error-message").text(message)}}}));

//# sourceMappingURL=valuemaps_manager.min.js.map