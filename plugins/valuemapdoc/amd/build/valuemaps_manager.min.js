define("aitoolsub_valuemapdoc/valuemaps_manager",["aitoolsub_valuemapdoc/tabulatorlib","jquery","core/ajax","core/notification"],(function(Tabulator,$,Ajax,Notification){var table,config=window.valuemapsConfig||{},allData=[];M.cfg.fullname||M.cfg.username;return{init:function(){console.log("[valuemaps_manager] Module loaded with Tabulator"),this.bindEvents(),this.loadData()},bindEvents:function(){$("#refresh-data").on("click",this.loadData.bind(this)),$("#export-data").on("click",this.showExportOptions.bind(this)),$("#clear-filters").on("click",this.clearFilters.bind(this)),$("#toggle-columns").on("click",this.showColumnModal.bind(this)),$("#filter-course, #filter-activity, #filter-type").on("change",this.applyFilters.bind(this)),$("#search-entries").on("input",this.applyFilters.bind(this)),$("#retry-loading").on("click",this.loadData.bind(this)),$("#apply-columns").on("click",this.applyColumnVisibility.bind(this)),$("#toggle-fullscreen").on("click",this.toggleFullscreen.bind(this))},loadData:function(){var self=this;this.showLoadingState(),Ajax.call([{methodname:"aitoolsub_valuemapdoc_get_all_entries_global",args:{userid:config.userid||0}}])[0].done((function(data){allData=(allData=data.entries||[]).map((function(entry){if("string"==typeof entry.entry_data)try{entry.entry_data=JSON.parse(entry.entry_data)}catch(e){console.warn("Could not parse entry_data for entry",entry.id,e),entry.entry_data={}}return entry})),console.log("[valuemaps_manager] Entries loaded:",allData.length,"records"),self.updateStatistics(data.statistics),self.populateFilterOptions(data),allData.length>0?(self.initializeTable(),self.showTableState()):self.showEmptyState()})).fail((function(error){console.error("[valuemaps_manager] Failed to load entries:",error),self.showErrorState(error.message||"Unknown error occurred"),Notification.exception(error)}))},showLoadingState:function(){$("#loading-overlay").show(),$("#valuemaps-table").hide(),$("#empty-state").hide(),$("#error-state").hide()},showTableState:function(){$("#loading-overlay").hide(),$("#valuemaps-table").show(),$("#empty-state").hide(),$("#error-state").hide()},showEmptyState:function(){$("#loading-overlay").hide(),$("#valuemaps-table").hide(),$("#empty-state").show(),$("#error-state").hide()},showErrorState:function(message){$("#loading-overlay").hide(),$("#valuemaps-table").hide(),$("#empty-state").hide(),$("#error-state").show(),$("#error-message").text(message)},updateStatistics:function(stats){$("#stat-total-entries").html(stats.total_entries||0),$("#stat-unique-courses").html(stats.unique_courses||0),$("#stat-unique-activities").html(stats.unique_activities||0)},populateFilterOptions:function(data){var courseSelect=$("#filter-course");courseSelect.empty().append('<option value="">All Courses</option>'),data.statistics&&data.statistics.courses_list&&data.statistics.courses_list.forEach((function(course){courseSelect.append($("<option>").val(course).text(course))}));var activitySelect=$("#filter-activity");activitySelect.empty().append('<option value="">All Activities</option>'),data.statistics&&data.statistics.activities_list&&data.statistics.activities_list.forEach((function(activity){activitySelect.append($("<option>").val(activity).text(activity))}))},initializeTable:function(){var self=this;table&&table.destroy();var columns=[{title:config.strings.id||"ID",field:"id",width:80,frozen:!0,headerFilter:"input",headerFilterPlaceholder:"Filter ID...",headerSort:!0},{title:config.strings.course||"Course",field:"course_name",width:200,headerFilter:"input",headerFilterPlaceholder:"Filter course...",formatter:function(cell){var data=cell.getRow().getData();return"<strong>"+data.course_name+'</strong><br><small class="text-muted">('+data.course_shortname+")</small>"}},{title:config.strings.activity||"Activity",field:"activity_name",width:180,headerFilter:"input",headerFilterPlaceholder:"Filter activity..."},{title:config.strings.entry_type||"Type",field:"entry_type",width:130,headerFilter:"select",headerFilterParams:{customer_profile:"Customer Profile",value_proposition:"Value Proposition",pain_analysis:"Pain Analysis",value_map:"Value Map",general:"General"},formatter:function(cell){var value=cell.getValue();return'<span class="badge '+({customer_profile:"bg-primary",value_proposition:"bg-success",pain_analysis:"bg-warning",value_map:"bg-info",general:"bg-secondary"}[value]||"bg-secondary")+'">'+self.formatTypeName(value)+"</span>"}},{title:config.strings.preview||"Preview",field:"entry_preview",width:300,headerFilter:"input",headerFilterPlaceholder:"Search preview...",formatter:function(cell){var preview=cell.getValue();return'<div class="text-truncate" title="'+preview+'">'+preview+"</div>"}},{title:config.strings.created||"Created",field:"timecreated_relative",width:120,sorter:function(a,b,aRow,bRow){return aRow.getData().timecreated-bRow.getData().timecreated},formatter:function(cell){var data=cell.getRow().getData();return'<span title="'+data.timecreated_formatted+'">'+data.timecreated_relative+"</span>"}},{title:config.strings.modified||"Modified",field:"timemodified_relative",width:120,sorter:function(a,b,aRow,bRow){return aRow.getData().timemodified-bRow.getData().timemodified},formatter:function(cell){var data=cell.getRow().getData();return'<span title="'+data.timemodified_formatted+'">'+data.timemodified_relative+"</span>"}},{title:config.strings.actions||"Actions",field:"actions",width:160,headerSort:!1,formatter:function(cell){var data=cell.getRow().getData();return'<div class="btn-group btn-group-sm" role="group"><a href="'+data.view_url+'" class="btn btn-outline-primary btn-sm" title="View Entry"><i class="fa fa-eye"></i></a><a href="'+data.edit_url+'" class="btn btn-outline-secondary btn-sm" title="Edit in Activity"><i class="fa fa-edit"></i></a><button class="btn btn-outline-info btn-sm" onclick="window.valuemapsManager.showEntryDetails('+data.id+')" title="Show Details"><i class="fa fa-info-circle"></i></button></div>'}}];(table=new Tabulator("#valuemaps-table",{data:allData,columns:columns,layout:"fitDataTable",responsiveLayout:"collapse",height:"600px",pagination:"local",paginationSize:20,paginationSizeSelector:[10,20,50,100],movableColumns:!0,resizableRows:!1,selectable:!1,tooltips:!0,placeholder:"No entries to display",persistence:{sort:!0,filter:!0,columns:!0,page:!0},persistenceID:"ai-tools-valuemaps-table",locale:!0,langs:{default:{pagination:{page_size:"Page Size",first:"First",prev:"Prev",next:"Next",last:"Last"},headerFilters:{default:"Filter column..."}}}})).on("tableBuilt",(function(){console.log("[valuemaps_manager] Table built successfully"),self.addUserFilterToggle()})),table.on("rowDblClick",(function(e,row){var editUrl=row.getData().edit_url;window.open(editUrl,"_blank")})),window.valuemapsManager=this},addUserFilterToggle:function(){var toolbar=$(".card-header .table-controls");if(0!==toolbar.length){toolbar.prepend('<button type="button" class="btn btn-sm btn-outline-info ms-2" id="user-filter-toggle"><i class="fa fa-user"></i> My Entries</button>');var showingAll=!0;$("#user-filter-toggle").on("click",(function(){var $btn=$(this);showingAll?($btn.html('<i class="fa fa-users"></i> All Entries'),$btn.removeClass("btn-outline-info").addClass("btn-outline-secondary"),showingAll=!1):(table&&table.clearFilter(),$btn.html('<i class="fa fa-user"></i> My Entries'),$btn.removeClass("btn-outline-secondary").addClass("btn-outline-info"),showingAll=!0)}))}},toggleFullscreen:function(){$("body").toggleClass("valuemapdoc-fullscreen");var $btn=$("#toggle-fullscreen");$("body").hasClass("valuemapdoc-fullscreen")?($btn.html('<i class="fa fa-compress"></i> Exit Fullscreen'),table&&table.redraw(!0)):($btn.html('<i class="fa fa-expand"></i> Fullscreen'),table&&table.redraw(!0))},showEntryDetails:function(entryId){var entryData=allData.find((function(entry){return entry.id===entryId}));if(entryData){var modalHtml='<div class="modal fade" id="entryDetailsModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Entry Details</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="row mb-3"><div class="col-md-6"><strong>Course:</strong><br>'+entryData.course_name+'</div><div class="col-md-6"><strong>Activity:</strong><br>'+entryData.activity_name+'</div></div><div class="row mb-3"><div class="col-md-6"><strong>Type:</strong><br><span class="badge '+this.getTypeBadgeClass(entryData.entry_type)+'">'+this.formatTypeName(entryData.entry_type)+'</span></div><div class="col-md-6"><strong>Created:</strong><br>'+entryData.timecreated_formatted+'</div></div><div class="mb-3"><strong>Preview:</strong><br><div class="border rounded p-3 bg-light">'+entryData.entry_preview+'</div></div></div><div class="modal-footer"><a href="'+entryData.edit_url+'" class="btn btn-primary" target="_blank"><i class="fa fa-edit"></i> Edit in Activity</a><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div></div></div></div>';$("#entryDetailsModal").remove(),$("body").append(modalHtml),$("#entryDetailsModal").modal("show")}},getTypeBadgeClass:function(type){return{customer_profile:"bg-primary",value_proposition:"bg-success",pain_analysis:"bg-warning",value_map:"bg-info",general:"bg-secondary"}[type]||"bg-secondary"},formatTypeName:function(type){return{customer_profile:"Customer Profile",value_proposition:"Value Proposition",pain_analysis:"Pain Analysis",value_map:"Value Map",general:"General",unknown:"Unknown"}[type]||type},applyFilters:function(){if(table){var courseFilter=$("#filter-course").val(),activityFilter=$("#filter-activity").val(),typeFilter=$("#filter-type").val(),searchFilter=$("#search-entries").val();table.clearFilter(),courseFilter&&table.addFilter("course_name","=",courseFilter),activityFilter&&table.addFilter("activity_name","=",activityFilter),typeFilter&&table.addFilter("entry_type","=",typeFilter),searchFilter&&table.addFilter([{field:"entry_preview",type:"like",value:searchFilter},{field:"course_name",type:"like",value:searchFilter},{field:"activity_name",type:"like",value:searchFilter}])}},clearFilters:function(){$("#filter-course, #filter-activity, #filter-type").val(""),$("#search-entries").val(""),table&&(table.clearFilter(),table.clearHeaderFilter())},showExportOptions:function(){var self=this,exportMenu=$('<div class="dropdown-menu dropdown-menu-end show"><h6 class="dropdown-header">Export Options</h6><button class="dropdown-item" data-format="csv"><i class="fa fa-file-csv me-2"></i>Export as CSV</button><button class="dropdown-item" data-format="json"><i class="fa fa-file-code me-2"></i>Export as JSON</button><button class="dropdown-item" data-format="xlsx"><i class="fa fa-file-excel me-2"></i>Export as Excel</button></div>'),exportBtn=$("#export-data"),offset=exportBtn.offset();$("body").append(exportMenu),exportMenu.css({position:"absolute",top:offset.top+exportBtn.outerHeight(),left:offset.left+exportBtn.outerWidth()-exportMenu.outerWidth(),zIndex:1050}),exportMenu.on("click",".dropdown-item",(function(e){var format=$(this).data("format");self.exportData(format),exportMenu.remove()})),$(document).one("click",(function(){exportMenu.remove()}))},exportData:function(format){if(table){var filename="valuemap_entries_"+(new Date).toISOString().slice(0,10);switch(format){case"csv":table.download("csv",filename+".csv");break;case"json":table.download("json",filename+".json");break;case"xlsx":table.download("xlsx",filename+".xlsx",{sheetName:"Value Map Entries"})}}},showColumnModal:function(){this.setupColumnModal(),$("#columnModal").modal("show")},setupColumnModal:function(){if(table){var checkboxContainer=$("#column-checkboxes");checkboxContainer.empty(),table.getColumnDefinitions().forEach((function(col){if(col.field&&"actions"!==col.field){var isVisible=table.getColumn(col.field).isVisible(),checkbox=$('<div class="form-check"><input class="form-check-input" type="checkbox" id="col-'+col.field+'" '+(isVisible?"checked":"")+'><label class="form-check-label" for="col-'+col.field+'">'+col.title+"</label></div>");checkboxContainer.append(checkbox)}}))}},applyColumnVisibility:function(){table&&($("#column-checkboxes .form-check-input").each((function(){var field=$(this).attr("id").replace("col-",""),isChecked=$(this).is(":checked"),column=table.getColumn(field);column&&(isChecked?column.show():column.hide())})),$("#columnModal").modal("hide"))}}}));

//# sourceMappingURL=valuemaps_manager.min.js.map