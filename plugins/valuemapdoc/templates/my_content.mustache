{{!
    My Content Template for ValueMapDoc AI Tools
    
    Context variables:
    * user_fullname - Current user's name
    * total_content - Total content count
    * total_courses - Total courses count
    * total_activities - Total activities count
    * has_content - Boolean if content exists
    * courses - Array of courses with activities and content
    * recent_content - Array of recent content items
    * back_url - URL back to AI Tools dashboard
}}

<div class="valuemapdoc-content-dashboard">
    <!-- Header -->
    <div class="content-header mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="{{back_url}}">
                                <i class="fa fa-robot"></i> {{#str}}aitools, local_aitools{{/str}}
                            </a>
                        </li>
                        <li class="breadcrumb-item active">{{#str}}my_content, aitoolsub_valuemapdoc{{/str}}</li>
                    </ol>
                </nav>
                
                <h1 class="h2 mb-2">
                    <i class="fa fa-file-text text-primary me-2"></i>
                    {{#str}}my_content_dashboard, aitoolsub_valuemapdoc{{/str}}
                </h1>
                <p class="text-muted mb-0">
                    {{#str}}content_dashboard_subtitle, aitoolsub_valuemapdoc{{/str}}
                </p>
            </div>
            <div class="col-md-4 text-end">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary" id="search-toggle">
                        <i class="fa fa-search"></i> {{#str}}search, core{{/str}}
                    </button>
                    <button type="button" class="btn btn-outline-secondary" id="filter-toggle">
                        <i class="fa fa-filter"></i> {{#str}}filter, core{{/str}}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <h3 class="mb-1">{{total_content}}</h3>
                    <small>{{#str}}total_documents, aitoolsub_valuemapdoc{{/str}}</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <h3 class="mb-1">{{total_courses}}</h3>
                    <small>{{#str}}courses_with_content, aitoolsub_valuemapdoc{{/str}}</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <h3 class="mb-1">{{total_activities}}</h3>
                    <small>{{#str}}activities_with_content, aitoolsub_valuemapdoc{{/str}}</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter Panel (Hidden by default) -->
    <div class="row mb-4" id="search-filter-panel" style="display: none;">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">{{#str}}search_content, aitoolsub_valuemapdoc{{/str}}</h6>
                    <input type="text" class="form-control" id="content-search" 
                           placeholder="{{#str}}search_placeholder, aitoolsub_valuemapdoc{{/str}}">
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">{{#str}}filter_options, aitoolsub_valuemapdoc{{/str}}</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <select class="form-select form-select-sm" id="template-filter">
                                <option value="">{{#str}}all_templates, aitoolsub_valuemapdoc{{/str}}</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <select class="form-select form-select-sm" id="status-filter">
                                <option value="">{{#str}}all_statuses, aitoolsub_valuemapdoc{{/str}}</option>
                                <option value="ready">{{#str}}status_ready, aitoolsub_valuemapdoc{{/str}}</option>
                                <option value="pending">{{#str}}status_pending, aitoolsub_valuemapdoc{{/str}}</option>
                                <option value="error">{{#str}}status_error, aitoolsub_valuemapdoc{{/str}}</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {{#has_content}}
        <div class="row">
            <!-- Main Content Area -->
            <div class="col-md-8">
                <h3 class="mb-3">
                    <i class="fa fa-folder-open me-2"></i>
                    {{#str}}content_by_course, aitoolsub_valuemapdoc{{/str}}
                </h3>
                
                <div class="courses-accordion" id="coursesAccordion">
                    {{#courses}}
                        <div class="card course-card mb-3">
                            <div class="card-header" id="heading-{{id}}">
                                <h2 class="mb-0">
                                    <button class="btn btn-link btn-block text-left collapsed" 
                                            type="button" 
                                            data-bs-toggle="collapse" 
                                            data-bs-target="#collapse-{{id}}" 
                                            aria-expanded="false" 
                                            aria-controls="collapse-{{id}}">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="fa fa-graduation-cap me-2"></i>
                                                <strong>{{name}}</strong>
                                                <small class="text-muted ms-2">({{shortname}})</small>
                                            </div>
                                            <div>
                                                <span class="badge bg-primary me-2">{{content_count}} {{#str}}documents, aitoolsub_valuemapdoc{{/str}}</span>
                                                <i class="fa fa-chevron-down"></i>
                                            </div>
                                        </div>
                                    </button>
                                </h2>
                            </div>
                            
                            <div id="collapse-{{id}}" 
                                 class="collapse" 
                                 aria-labelledby="heading-{{id}}" 
                                 data-bs-parent="#coursesAccordion">
                                <div class="card-body">
                                    {{#activities}}
                                        <div class="activity-section mb-4">
                                            <h5 class="mb-3">
                                                <i class="fa fa-tasks text-info me-2"></i>
                                                {{name}}
                                                <span class="badge bg-secondary ms-2">{{content_count}}</span>
                                            </h5>
                                            
                                            <div class="row">
                                                {{#content}}
                                                    <div class="col-md-6 mb-3">
                                                        <div class="card content-item h-100">
                                                            <div class="card-body">
                                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                                    <h6 class="card-title mb-1">{{name}}</h6>
                                                                    <span class="badge {{#eq status "ready"}}bg-success{{/eq}}{{#eq status "pending"}}bg-warning{{/eq}}{{#eq status "error"}}bg-danger{{/eq}}">
                                                                        {{status}}
                                                                    </span>
                                                                </div>
                                                                
                                                                <p class="card-text small text-muted mb-2">
                                                                    <strong>{{#str}}template, aitoolsub_valuemapdoc{{/str}}:</strong> {{template_name}}
                                                                </p>
                                                                
                                                                <p class="card-text small content-preview">
                                                                    {{content_preview}}
                                                                </p>
                                                                
                                                                <div class="d-flex justify-content-between align-items-center">
                                                                    <small class="text-muted">{{timecreated_relative}}</small>
                                                                    {{#effectiveness}}
                                                                        <div class="effectiveness-score">
                                                                            <small class="text-muted">{{#str}}effectiveness, aitoolsub_valuemapdoc{{/str}}: </small>
                                                                            <span class="badge {{#gte effectiveness 8}}bg-success{{/gte}}{{#and (gte effectiveness 5) (lt effectiveness 8)}}bg-warning{{/and}}{{#lt effectiveness 5}}bg-danger{{/lt}}">
                                                                                {{effectiveness}}/10
                                                                            </span>
                                                                        </div>
                                                                    {{/effectiveness}}
                                                                </div>
                                                                
                                                                <div class="mt-2">
                                                                    <div class="btn-group btn-group-sm w-100" role="group">
                                                                        <a href="{{view_url}}" class="btn btn-outline-primary">
                                                                            <i class="fa fa-eye"></i> {{#str}}view, core{{/str}}
                                                                        </a>
                                                                        <a href="{{edit_url}}" class="btn btn-outline-secondary">
                                                                            <i class="fa fa-edit"></i> {{#str}}edit, core{{/str}}
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {{/content}}
                                            </div>
                                        </div>
                                    {{/activities}}
                                </div>
                            </div>
                        </div>
                    {{/courses}}
                </div>
            </div>
            
            <!-- Sidebar with Recent Activity -->
            <div class="col-md-4">
                <div class="card sticky-top">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fa fa-clock me-2"></i>
                            {{#str}}recent_activity, aitoolsub_valuemapdoc{{/str}}
                        </h5>
                    </div>
                    <div class="card-body">
                        {{#recent_content}}
                            <div class="recent-item mb-3 pb-3 border-bottom">
                                <h6 class="mb-1">
                                    <a href="{{view_url}}" class="text-decoration-none">{{name}}</a>
                                </h6>
                                <small class="text-muted d-block">
                                    {{course_name}} → {{activity_name}}
                                </small>
                                <small class="text-muted">{{timecreated_relative}}</small>
                            </div>
                        {{/recent_content}}
                    </div>
                </div>
            </div>
        </div>
    {{/has_content}}

    {{^has_content}}
        <div class="text-center py-5">
            <div class="empty-state">
                <i class="fa fa-file-text fa-4x text-muted mb-3"></i>
                <h3>{{#str}}no_content_yet, aitoolsub_valuemapdoc{{/str}}</h3>
                <p class="text-muted mb-4">{{#str}}no_content_description, aitoolsub_valuemapdoc{{/str}}</p>
                <a href="/course/" class="btn btn-primary">
                    <i class="fa fa-plus me-2"></i>
                    {{#str}}browse_courses, aitoolsub_valuemapdoc{{/str}}
                </a>
            </div>
        </div>
    {{/has_content}}
</div>

{{#js}}
require(['jquery'], function($) {
    $(document).ready(function() {
        // Toggle search and filter panel
        $('#search-toggle, #filter-toggle').on('click', function() {
            $('#search-filter-panel').slideToggle();
        });
        
        // Search functionality
        $('#content-search').on('input', function() {
            var searchTerm = $(this).val().toLowerCase();
            $('.content-item').each(function() {
                var contentText = $(this).text().toLowerCase();
                if (contentText.includes(searchTerm)) {
                    $(this).closest('.col-md-6').show();
                } else {
                    $(this).closest('.col-md-6').hide();
                }
            });
        });
        
        // Filter functionality
        $('#template-filter, #status-filter').on('change', function() {
            var templateFilter = $('#template-filter').val();
            var statusFilter = $('#status-filter').val();
            
            $('.content-item').each(function() {
                var show = true;
                
                if (templateFilter && !$(this).find('.card-text:contains("' + templateFilter + '")').length) {
                    show = false;
                }
                
                if (statusFilter && !$(this).find('.badge:contains("' + statusFilter + '")').length) {
                    show = false;
                }
                
                if (show) {
                    $(this).closest('.col-md-6').show();
                } else {
                    $(this).closest('.col-md-6').hide();
                }
            });
        });
        
        // Accordion improvements
        $('.collapse').on('show.bs.collapse', function() {
            $(this).prev().find('.fa-chevron-down').removeClass('fa-chevron-down').addClass('fa-chevron-up');
        });
        
        $('.collapse').on('hide.bs.collapse', function() {
            $(this).prev().find('.fa-chevron-up').removeClass('fa-chevron-up').addClass('fa-chevron-down');
        });
    });
});
{{/js}}